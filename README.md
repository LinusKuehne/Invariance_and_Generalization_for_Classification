# Invariance and Generalization for Classification
 This repo contains the code associated with the master's thesis "Invariance and Generalization for Classification" written by Linus Kühne at the Seminar for Statistics, Department of Mathematics, ETH Zurich, in 2024. The thesis wa#s supervised by Prof. Jonas Peters and co-supervised by Sorawit (James) Saengkyongam. 

 ## Content of the repository
 This repo contains all code used to create parts of the thesis. It also contains pre-processed data from the pyrocast database presented in (Tazi et al., [2022](https://arxiv.org/abs/2211.13052v1)). The preprocessing is explained in the thesis and in (Salas-Porras et al., [2022](https://arxiv.org/abs/2211.08883v3)). I have explicit permission by Kenza Tazi to publish these files here. 

When running a script, make sure the working directory is set to the script's location within the following folder structure:

* "code" contains the functions used by the different experiments on simulated data and the pyroCb data.
    * "code_pyroCb" contains scripts implementing the invariance tests (pyroCb_invariance_tests.R) and utility functions for Stabilized Classification (pyroCb_stabilized_classification_utils.R) *for the pyroCb dataset*
    * "code_simulation" contains a script to generate data from the standard, semi-random, and random SCM (data_generating_process.R), a script implementing the different invariance tests (invariance_tests.R), a script containing the code for Stabilized Classification (stabilized_classification.R), and utility functions (utils.R). These scripts are written for the data generated from the script data_generating_process.R. For example, they assume that the first d columns of a dataframe containing a generated dataset correspond to the observations of the predictors 1, ..., d. The next column (d+1) is the response Y.
* "data" contains the pyroCb data. The folder "pyroCb_data_python" contains the data I have received from Emiliano Dìaz Salas-Porras, co-author of (Salas-Porras et al., [2022](https://arxiv.org/abs/2211.08883v3)). It is in python formats .npy and .pkl. The file exported_pyrocb.rdata contains the data transformed into a .rdata file with the script experiments_pyroCb/data_preparation/transform_data.R in this repo.
* "experiments_pyroCb" contains the scripts used for the analyses in Chapter 6 of the thesis (and a small part of Appendix B).
    * "data_preparation" contains the scripts to divide the observations into 5 or 9 environments (create_environments.R), the aforementioned script to transform the python files into .rdata files (transform_data.R), and the file with the variable screening procedure using the group lasso for logistic regression (variable_screening.R).
    * "pyroCb_ICP" contains scripts to run the ICP algorithm on the pyroCb data with different configurations and divisions into different environments. The files are called pyroCb_ICP_<test>.R, where <test> stands for the name of the invariance test used.
    * "pyroCb_stabilized_classification" contains scripts for Stabilized Classification and related methods for the pyroCb dataset. pyroCb_similarity_tests.R compares Kendall's Tau of the vectors of p-values computed by the scripts from the folder "pyroCb_ICP". pyroCb_subsets_generalization.R computes the LOEO CV loss for every subset of the 13 screened variables. The other scripts compute the LOEO CV loss for the models presented in Table 6.4.
    * "saved_data" contains the data saved by all experiments from the folder "experiments_pyroCb" except those from "pyroCb_stabilized_classification_appendix". The files have the same name as the corresponding script (with the .rdata ending instead of .R).
    * "saved_plots" contains all generated plots by the experiments from the folder "experiments_pyroCb". The plots have the same name as the corresponding script (with the .pdf ending instead of .R).
    * "sessionInfo" contains the output of the R command sessionInfo() run after each experiment from the folder "experiments_pyroCb" except those from "pyroCb_stabilized_classification_appendix". The text files have the same name as the corresponding script (with the .txt ending instead of .R).


* "simulations" contains all scripts and outputs for the experiments conducted on synthetically generated data.
    * "saved_data" contains the data generated by each script. The data files have the same name as the corresponding script (with the .rdata ending instead of .R).
    * "saved_plots" contains the plots generated by each script. The plots have the same name as the corresponding script (with the .pdf ending instead of .R).
    * "sessionInfo" contains the output of the R command sessionInfo() run at the end of each script. The text files have the same name as the corresponding script (with the .txt ending instead of .R).
    * The rest of the files in this folder are R scripts for the experiments on synthetic data.
 


## Code used across different experiments

| Method | Script location/name |
| --- | --- |
| Utilities (loss functions, DAG functions, etc.) | code/code_simulations/utils.R |
| Invariance tests from Chapter 3 | code/code_simulations/invariance_tests.R |
| Stabilized classification from Subsection 4.4.3 | code/code_simulations/stabilized_classification.R |
| Data generating process (Section 5.1 and Subsection B.3.1) | code/code_simulations/data_generating_process.R |
| Invariance tests for pyroCb data | code/code_pyroCb/pyroCb_invariance_tests.R |
| Utilities for stabilized classification on pyroCb data | code/code_pyroCb/pyroCb_stabilized_classification_utils.R |
|  |  |
|  |  |

## Data

| Kind of data | Data location/name |
| --- | --- |
| Stored data for simulation experiments for the experiments in Chapter 5, and Sections B.3 and B.4 | simulations/saved_data |
| Stored sessionInfo files for simulation experiments for the experiments in Chapter 5, and Sections B.3 and B.4 | simulations/sessionInfo |
| Generated plots for simulation experiments for the experiments in Chapter 5, and Sections B.3 and B.4 | simulations/saved_plots |
| PyroCb data provided by authors of (Salas-Porras et al., [2022](https://arxiv.org/abs/2211.08883v3)) | data/pyroCb_data_python |
| Exported pyroCb data into .rdata format with script experiments_pyroCb/data_preparation/transform_data.R | data/exported_pyrocb.rdata |
| Stored data for the experiments in Chapter 6 and Subsection B.4.3 | experiments_pyroCb/saved_data |
| Stored sessionInfo files for the experiments in Chapter 6 and Subsection B.4.3 | experiments_pyroCb/sessionInfo |
| Generated plots from Chapter 6 | experiments_pyroCb/saved_plots |

## Specific experiments

| Object in thesis | Script location/name |
| --- | --- |
| Invariance tests from Chapter 3 | code/code_simulations/invariance_tests.R |
| Table 4.1 | simulations/example_predicting_on_inv_sets.R |
| Stabilized classification from Subsection 4.4.3 | code/code_simulations/stabilized_classification.R |
| Data generating process (Section 5.1) | code/code_simulations/data_generating_process.R |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |
|  |  |



Explain data









